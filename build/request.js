// Generated by CoffeeScript 1.7.1
var Request, Response, request, url, _;

request = require('request');

url = require('url');

_ = require('underscore');

Response = require('./response');

Request = (function() {
  Request.prototype.response = null;

  function Request(module, _request) {
    this.module = module;
    this._request = _request;
    if (!this.module) {
      throw new Error('Requires Zoho Module');
    }
    if (!this._request) {
      throw new Error('Requires request');
    }
    return;
  }

  Request.prototype.request = function(cb) {
    var options;
    options = _.pick(this._request, ['method', 'form']);
    options.uri = url.format(this._request);
    return request(options, (function(_this) {
      return function(error, response, body) {
        if (error) {
          error.data = options.form.xmlData;
          return cb(error, null);
        } else {
          _this.response = new Response(response);
          return _this.response.parseBody(body, options.form.xmlData, cb);
        }
      };
    })(this));
  };

  return Request;

})();

module.exports = Request;
